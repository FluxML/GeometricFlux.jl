<!DOCTYPE html><HTML lang="en"><head><script charset="utf-8" src="../../../../../../../../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/'</script><script charset="utf-8" src="../../../../../../../../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../../../../../../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><script charset="utf-8" src="../../../../../../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/'</script><script charset="utf-8" src="../../../../../../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../../../../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><script charset="utf-8" src="../../../../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/'</script><script charset="utf-8" src="../../../../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><script charset="utf-8" src="../../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/'</script><script charset="utf-8" src="../../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Message passing scheme · GeometricFlux.jl</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-M61P0B2Y8E"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-M61P0B2Y8E', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner="" src="../../assets/warner.js"></script><link href="https://fluxml.ai/GeometricFlux.jl/stable/abstractions/msgpass/" rel="canonical"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script data-main="../../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" data-theme-name="documenter-dark" data-theme-primary-dark="" href="../../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../../assets/themeswap.js"></script><link href="../../assets/flux.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/><link href="../../../../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/><link href="../../../../../../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../../../../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/><link href="../../../../../../../../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../../../../../../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/></head><body><nav id="multi-page-nav"><div class="hidden-on-mobile" id="nav-items"><a class="nav-link active nav-item" href="../../../../../../../../../">GeometricFlux</a><a class="nav-link nav-item" href="../../../../../../../../../../graphsignals/stable/">GraphSignals</a><div class="search nav-item"><input id="search-input" placeholder="Search..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><nav id="multi-page-nav"><div class="hidden-on-mobile" id="nav-items"><a class="nav-link active nav-item" href="../../../../../../../">GeometricFlux</a><a class="nav-link nav-item" href="../../../../../../../../graphsignals/stable/">GraphSignals</a><div class="search nav-item"><input id="search-input" placeholder="Search..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><nav id="multi-page-nav"><div class="hidden-on-mobile" id="nav-items"><a class="nav-link active nav-item" href="../../../../../">GeometricFlux</a><a class="nav-link nav-item" href="../../../../../../graphsignals/stable/">GraphSignals</a><div class="search nav-item"><input id="search-input" placeholder="Search..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><nav id="multi-page-nav"><div class="hidden-on-mobile" id="nav-items"><a class="nav-link active nav-item" href="../../../">GeometricFlux</a><a class="nav-link nav-item" href="../../../../graphsignals/stable/">GraphSignals</a><div class="search nav-item"><input id="search-input" placeholder="Search..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img alt="GeometricFlux.jl logo" src="../../assets/logo.svg"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GeometricFlux.jl</a></span></div><form action="../../search/" class="docs-search"><input class="docs-search-query" id="documenter-search-query" name="q" placeholder="Search docs" type="text"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/semisupervised_gcn/">Semi-Supervised Learning with GCN</a></li><li><a class="tocitem" href="../../tutorials/gcn_fixed_graph/">GCN with Fixed Graph</a></li><li><a class="tocitem" href="../../tutorials/gat/">Graph Attention Network</a></li><li><a class="tocitem" href="../../tutorials/deepset/">DeepSet for Digit Sum</a></li><li><a class="tocitem" href="../../tutorials/vgae/">Variational Graph Autoencoder</a></li><li><a class="tocitem" href="../../tutorials/graph_embedding/">Graph Embedding</a></li></ul></li><li><a class="tocitem" href="../../introduction/">Introduction</a></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/conv/">Graph Convolutions</a></li><li><a class="tocitem" href="../../basics/passgraph/">Graph Passing</a></li><li><a class="tocitem" href="../../basics/layers/">Building Layers</a></li><li><a class="tocitem" href="../../basics/subgraph/">Subgraph</a></li><li><a class="tocitem" href="../../basics/neighborhood_graph/">Neighborhood graphs</a></li><li><a class="tocitem" href="../../basics/random_graph/">Random graphs</a></li><li><a class="tocitem" href="../../basics/batch/">Batch Learning</a></li></ul></li><li><a class="tocitem" href="../../cooperate/">Cooperate with Flux Layers</a></li><li><span class="tocitem">Abstractions</span><ul><li class="is-active"><a class="tocitem" href="">Message passing scheme</a><ul class="internal"><li><a class="tocitem" href="#Message-function"><span>Message function</span></a></li><li><a class="tocitem" href="#Aggregate-messages"><span>Aggregate messages</span></a></li><li><a class="tocitem" href="#Update-function"><span>Update function</span></a></li></ul></li><li><a class="tocitem" href="../gn/">Graph network block</a></li></ul></li><li><a class="tocitem" href="../../dynamicgraph/">Dynamic Graph Update</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/featuredgraph/">FeaturedGraph</a></li><li><a class="tocitem" href="../../manual/graph_conv/">Graph Convolutional Layers</a></li><li><a class="tocitem" href="../../manual/pool/">Graph Pooling Layers</a></li><li><a class="tocitem" href="../../manual/group_conv/">Group Convolutional Layers</a></li><li><a class="tocitem" href="../../manual/positional/">Positional Encoding Layers</a></li><li><a class="tocitem" href="../../manual/embedding/">Embeddings</a></li><li><a class="tocitem" href="../../manual/models/">Models</a></li><li><a class="tocitem" href="../../manual/linalg/">Linear Algebra</a></li><li><a class="tocitem" href="../../manual/neighborhood_graph/">Neighborhood graphs</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Abstractions</a></li><li class="is-active"><a href="">Message passing scheme</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">Message passing scheme</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/FluxML/GeometricFlux.jl/blob/master/docs/src/abstractions/msgpass.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a></div></header><article class="content" id="documenter-page"><h1 id="Message-passing-scheme"><a class="docs-heading-anchor" href="#Message-passing-scheme">Message passing scheme</a><a id="Message-passing-scheme-1"></a><a class="docs-heading-anchor-permalink" href="#Message-passing-scheme" title="Permalink"></a></h1><p>Message passing scheme is a popular GNN scheme in many frameworks. It adapts the property of connectivity of neighbors and form a general approach for spatial graph convolutional neural network. It comprises two user-defined functions and one aggregate function. A message function is defined to process information from edge states and node states from neighbors and itself. Messages from each node are obtained and aggregated by aggregate function to provide node-level information for update function. Update function takes current node state and aggregated message and gives a new node state.</p><p class="math-container">\[\begin{aligned}
    m_{ij}^{(l+1)} &amp;= message(h_i^{(l)}, h_j^{(l)}, e_{ij}^{(l)}) \\
    m_{i}^{(l+1)} &amp;= \Box_{j \in \mathcal{N}(i)} m_{ij}^{(l+1)} \\
    h_i^{(l+1)} &amp;= update(h_i^{(l)}, m_{i}^{(l+1)})
\end{aligned}\]</p><p>where <span>$h_i$</span> and <span>$h_j$</span> are node features from node <span>$i$</span> and its neighbor node <span>$j$</span>, <span>$e_{ij}$</span> is edge feature for edge <span>$(i, j)$</span>, and <span>$u$</span> is global feature for whole graph. <span>$m_{ij}^{(l+1)}$</span> denotes messages for <span>$(i, j)$</span> in <span>$l$</span>-th layer. <span>$message$</span> and <span>$update$</span> are message functions and update function, respectively. Aggregate function <span>$\Box$</span> can be any supported aggregate functions, e.g. <code>max</code>, <code>sum</code> or <code>mean</code>.</p><blockquote><p>Reference: <a href="../../references/#Gilmer2017">Justin Gilmer, Samuel S. Schoenholz, Patrick F. Riley, Oriol Vinyals, George E. Dahl (2017)</a></p></blockquote><p>Message passing scheme is realized into a abstract type <code>MessagePassing</code>. Any subtype of <code>MessagePassing</code> is a message passing layer which utilize default message and update functions:</p><pre><code class="nohighlight hljs">message(mp, x_i, x_j, e_ij) = x_j
update(mp, m, x) = m</code></pre><p><code>mp</code> denotes a message passing layer. <code>message</code> accepts node state <code>x_i</code> for node <code>i</code> and its neighbor state <code>x_j</code> for node <code>j</code>, as well as corresponding edge state <code>e_ij</code> for edge <code>(i,j)</code>. The default message function gives all the neighbor state <code>x_j</code> for neighbor of node <code>i</code>. <code>update</code> takes aggregated message <code>m</code> and current node state <code>x</code>, and then outputs <code>m</code>.</p><article class="docstring"><header><a class="docstring-binding" href="#GeometricFlux.MessagePassing" id="GeometricFlux.MessagePassing"><code>GeometricFlux.MessagePassing</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">MessagePassing</code></pre><p>An abstract type for message-passing scheme.</p><p>See also <a href="#GeometricFlux.message"><code>message</code></a> and <a href="#GeometricFlux.update"><code>update</code></a>.</p></div><a class="docs-sourcelink" href="https://github.com/FluxML/GeometricFlux.jl/blob/cb1642cb1920623c8292b5c1281fed24ce5bbea9/src/layers/msgpass.jl#L1-L7" target="_blank">source</a></section></article><h2 id="Message-function"><a class="docs-heading-anchor" href="#Message-function">Message function</a><a id="Message-function-1"></a><a class="docs-heading-anchor-permalink" href="#Message-function" title="Permalink"></a></h2><p>A message function accepts feature vector representing node state <code>x_i</code>, feature vectors for neighbor state <code>x_j</code> and corresponding edge state <code>e_ij</code>. A vector is expected to output from <code>message</code> for message. User can override <code>message</code> for customized message passing layer to provide desired behavior.</p><article class="docstring"><header><a class="docstring-binding" href="#GeometricFlux.message" id="GeometricFlux.message"><code>GeometricFlux.message</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">message(mp::MessagePassing, x_i, x_j, e_ij)</code></pre><p>Message function for the message-passing scheme, returning the message from node <code>j</code> to node <code>i</code> . In the message-passing scheme. the incoming messages  from the neighborhood of <code>i</code> will later be aggregated in order to <a href="#GeometricFlux.update"><code>update</code></a> the features of node <code>i</code>.</p><p>By default, the function returns <code>x_j</code>. Layers subtyping <a href="#GeometricFlux.MessagePassing"><code>MessagePassing</code></a> should  specialize this method with custom behavior.</p><p><strong>Arguments</strong></p><ul><li><code>mp</code>: message-passing layer.</li><li><code>x_i</code>: the features of node <code>i</code>.</li><li><code>x_j</code>: the features of the nighbor <code>j</code> of node <code>i</code>.</li><li><code>e_ij</code>: the features of edge (<code>i</code>, <code>j</code>).</li></ul><p>See also <a href="#GeometricFlux.update"><code>update</code></a>.</p></div><a class="docs-sourcelink" href="https://github.com/FluxML/GeometricFlux.jl/blob/cb1642cb1920623c8292b5c1281fed24ce5bbea9/src/layers/msgpass.jl#L10-L31" target="_blank">source</a></section></article><h2 id="Aggregate-messages"><a class="docs-heading-anchor" href="#Aggregate-messages">Aggregate messages</a><a id="Aggregate-messages-1"></a><a class="docs-heading-anchor-permalink" href="#Aggregate-messages" title="Permalink"></a></h2><p>Messages from message function are aggregated by an aggregate function. An aggregated message is passed to update function for node-level computation. An aggregate function is given by the following:</p><pre><code class="nohighlight hljs">propagate(mp, fg::FeaturedGraph, aggr::Symbol=:add)</code></pre><p><code>propagate</code> function calls the whole message passing layer. <code>fg</code> acts as an input for message passing layer and <code>aggr</code> represents assignment of aggregate function to <code>propagate</code> function. <code>:add</code> represents an aggregate function of addition of all messages.</p><p>The following <code>aggr</code> are available aggregate functions:</p><p><code>:add</code>: sum over all messages <code>:sub</code>: negative of sum over all messages <code>:mul</code>: multiplication over all messages <code>:div</code>: inverse of multiplication over all messages <code>:max</code>: the maximum of all messages <code>:min</code>: the minimum of all messages <code>:mean</code>: the average of all messages</p><h2 id="Update-function"><a class="docs-heading-anchor" href="#Update-function">Update function</a><a id="Update-function-1"></a><a class="docs-heading-anchor-permalink" href="#Update-function" title="Permalink"></a></h2><p>An update function takes aggregated message <code>m</code> and current node state <code>x</code> as arguments. An output vector is expected to be the new node state for next layer. User can override <code>update</code> for customized message passing layer to provide desired behavior.</p><article class="docstring"><header><a class="docstring-binding" href="#GeometricFlux.update" id="GeometricFlux.update"><code>GeometricFlux.update</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">update(mp::MessagePassing, m, x)</code></pre><p>Update function for the message-passing scheme, returning a new set of node features <code>x′</code> based on old  features <code>x</code> and the incoming message from the neighborhood aggregation <code>m</code>.</p><p>By default, the function returns <code>m</code>. Layers subtyping <a href="#GeometricFlux.MessagePassing"><code>MessagePassing</code></a> should  specialize this method with custom behavior.</p><p><strong>Arguments</strong></p><ul><li><code>mp</code>: message-passing layer.</li><li><code>m</code>: the aggregated edge messages from the <a href="#GeometricFlux.message"><code>message</code></a> function.</li><li><code>x</code>: the node features to be updated.</li></ul><p>See also <a href="#GeometricFlux.message"><code>message</code></a>.</p></div><a class="docs-sourcelink" href="https://github.com/FluxML/GeometricFlux.jl/blob/cb1642cb1920623c8292b5c1281fed24ce5bbea9/src/layers/msgpass.jl#L37-L56" target="_blank">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../cooperate/">« Cooperate with Flux Layers</a><a class="docs-footer-nextpage" href="../gn/">Graph network block »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Monday 1 August 2022 03:31">Monday 1 August 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>